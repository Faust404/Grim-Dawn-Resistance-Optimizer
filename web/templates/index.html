<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grim Dawn Resistance Optimizer</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚ö° Resistance Optimizer</h1>
      <p>Optimize your gear resistances with advanced algorithms</p>
    </div>

    <form method="post">
      <div class="section">
        <h2>‚öôÔ∏è Weapon Template</h2>
        <div class="form-group">
          <select id="template" name="template">
            <option value="one-hand-shield" {% if data.weapon_template == 'one-hand-shield' %}selected{% endif %}>One-hand Weapon + Shield</option>
            <option value="one-hand-offhand" {% if data.weapon_template == 'one-hand-offhand' %}selected{% endif %}>One-hand Weapon + Off-Hand</option>
            <option value="ranged-offhand" {% if data.weapon_template == 'ranged-offhand' %}selected{% endif %}>Ranged Weapon + Off-Hand</option>
            <option value="two-hand" {% if data.weapon_template == 'two-hand' %}selected{% endif %}>Two-hand Weapon</option>
          </select>
        </div>
        <br>
      </div>

      <div class="section">
        <h2>‚öôÔ∏è Configuration</h2>
        <div class="form-group">
          <label for="char-level">Character Level:</label>
          <div class="resistance-input" style="max-width: 210px;">
            <input type="number" name="char-level" value="100" min="1" max="100">
          </div>
        </div>
        <div class="form-group">
          <label>Current Resistances:</label>
          <div class="resistance-grid">
            <div class="resistance-input">
              <label>Fire:</label>
              <input type="number" name="current-fire" value="{{ data['Fire Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Cold:</label>
              <input type="number" name="current-cold" value="{{ data['Cold Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Lightning:</label>
              <input type="number" name="current-lightning" value="{{ data['Lightning Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Poison & Acid:</label>
              <input type="number" name="current-poison" value="{{ data['Poison & Acid Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Pierce:</label>
              <input type="number" name="current-pierce" value="{{ data['Pierce Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Bleeding:</label>
              <input type="number" name="current-bleeding" value="{{ data['Bleeding Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Vitality:</label>
              <input type="number" name="current-vitality" value="{{ data['Vitality Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Aether:</label>
              <input type="number" name="current-aether" value="{{ data['Aether Resistance'] or 40 }}" min="0" max="100">
            </div>
            <div class="resistance-input">
              <label>Chaos:</label>
              <input type="number" name="current-chaos" value="{{ data['Chaos Resistance'] or 40 }}" min="0" max="100">
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>‚öôÔ∏è Unavailable Component Slots</h2>
        <div class="form-group">
          <div class="locations">
            <label><input type="checkbox" name="lock-head" {% if data['Helm'] %}checked{% endif %}> Head</label>
            <label><input type="checkbox" name="lock-chest" {% if data['Chest'] %}checked{% endif %}> Chest</label>
            <label><input type="checkbox" name="lock-shoulder" {% if data['Shoulders'] %}checked{% endif %}> Shoulders</label>
            <label><input type="checkbox" name="lock-hand" {% if data['Gloves'] %}checked{% endif %}> Gloves</label>
            <label><input type="checkbox" name="lock-foot" {% if data['Boots'] %}checked{% endif %}> Boots</label>
            <label><input type="checkbox" name="lock-legs" {% if data['Pants'] %}checked{% endif %}> Pants</label>
            <label><input type="checkbox" name="lock-belt" {% if data['Belt'] %}checked{% endif %}> Belt</label>
            <label><input type="checkbox" name="lock-amulet" {% if data['Amulet'] %}checked{% endif %}> Amulet</label>
            <label><input type="checkbox" name="lock-ring1" {% if data['Ring 1'] %}checked{% endif %}> Ring 1</label>
            <label><input type="checkbox" name="lock-ring2" {% if data['Ring 2'] %}checked{% endif %}> Ring 2</label>
            <label><input type="checkbox" name="lock-medal" {% if data['Medal'] %}checked{% endif %}> Medal</label>
            <label><input type="checkbox" name="lock-weapon" {% if data['Weapon'] %}checked{% endif %}> Weapon</label>
            <label><input type="checkbox" name="lock-shield" {% if data['Shield'] %}checked{% endif %}> Shield</label>
            <label><input type="checkbox" name="lock-offhand" {% if data['Off-Hand'] %}checked{% endif %}> Off-Hand</label>
          </div>
        </div>
      </div>
      <button type="submit" class="optimize-btn">üöÄ Run Optimization</button>
    </form>

    {% if results %}
    <div class="section results">
      <h2>Results</h2>

      <table class="results-table">
        <thead>
          <tr>
            <th>Gear Slot</th>
            <th>Component</th>
          </tr>
        </thead>
        <tbody>
        {% for slot, component in results.items() %}
          <tr>
            <td>{{ slot }}</td>
            <td>
              {% if component.Name and component.Url %}
                <a href="{{ component.Url }}" target="_blank">{{ component.Name }}</a>
              {% else %}
                <!-- If empty, show a dash or placeholder -->
                <span style="color: #888;">-</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
    </table>

    </div>
    {% endif %}

    {% if final_resistances %}
    <div class="section final-resistances">
      <h2>Final Resistances</h2>
      <table class="resistances-table">
        <thead>
          <tr>
            <th>Type</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          {% for res, val in final_resistances.items() %}
          <tr>
            <td>{{ res }}</td>
            <td>
              <span class="res-val 
                {% if val >= 80 %}success
                {% elif val >= 50 %}warning
                {% else %}danger
                {% endif %}">
                {{ val }}%
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}

  </div>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grim Dawn Resistance Optimizer</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚ö° Grim Dawn Resistance Optimizer</h1>
      <p>Optimize your Resistances With Every Available Component and Augment in the Game</p>
    </div>

    <form method="post">

      <!-- TAB CONTROLS -->
      <div class="tabs">
        <button type="button" class="tab active" data-tab="basic">Basic Config</button>
        <button type="button" class="tab" data-tab="advanced">Advanced Config</button>
      </div>
      
      <!-- BASIC TAB CONTENT -->
      <div class="tab-content active" id="tab-basic">

        <div class="section">
          <h2>‚öôÔ∏è Weapon Template</h2>
          <div class="form-group">
            <select id="template" name="template"></select>
          </div>
        </div>

        <div class="section">
          <h2>‚öôÔ∏è Configuration</h2>
          <div class="form-group">
            <label for="char-level">Character Level:</label>
            <div class="resistance-input" style="max-width: 210px;">
              <input type="number" name="char-level" id="char-level" value="100" min="1" max="100">
            </div>
          </div>
          <div class="form-group">
            <label>Current Resistances:</label>
            <div id="resistances-section" class="resistance-grid"></div>
          </div>
        </div>

        <div class="section">
          <h2>‚öôÔ∏è Unavailable Component Slots</h2>
          <div class="form-group">
            <div id="component-slots-section" class="locations"></div>
          </div>
        </div>

        <div class="section">
          <h2>‚öôÔ∏è Unavailable Augment Slots</h2>
          <div class="form-group">
            <div id="augment-slots-section" class="locations"></div>
          </div>
        </div>
      </div>

      <!-- ADVANCED TAB CONTENT -->
      <div class="tab-content" id="tab-advanced">
        <div class="section">
          <h2>‚öôÔ∏è Player Target Resistances</h2>
          <div class="form-group">
            <label>Target Resistances:</label>
            <div id="target-resistances-section" class="resistance-grid"></div>
          </div>
        </div>

        <div class="factions-section">
          <h2>‚öôÔ∏è Player Faction Standing</h2>
          <div id="faction-dropdowns-section" class="dropdown-grid"></div>
        </div>
      </div>

      <button type="submit" class="optimize-btn">üöÄ Run Optimization</button>
    </form>

    {% if results %}
    <div class="section results">
      <h2>Results</h2>

      <table class="results-table">
      <thead>
        <tr>
          <th>Gear Slot</th>
          <th>Component</th>
          <th>Augment</th>
        </tr>
      </thead>
      <tbody>
        {% for slot, values in results.items() %}
        <tr>
          <td>{{ slot }}</td>
          <td>
            {% if values.Component.Name %}
              {% if values.Component.Name == "Slot Unavailable" %}
                <span style="color: #ff6b6b; font-weight: 600;">{{ values.Component.Name }}</span>
              {% elif values.Component.Url %}
                <a href="{{ values.Component.Url }}" target="_blank" data-language-Tag="{{ values.Component.Tag }}">{{ values.Component.Name }}</a>
              {% else %}
                {{ values.Component.Name }}
              {% endif %}
            {% else %}
              <span style="color: #888;">-</span>
            {% endif %}
          </td>
          <td>
            {% if values.Augment.Name %}
              {% if values.Augment.Name == "Slot Unavailable" %}
                <span style="color: #ff6b6b; font-weight: 600;">{{ values.Augment.Name }}</span>
              {% elif values.Augment.Url %}
                <a href="{{ values.Augment.Url }}" target="_blank" data-language-Tag="{{ values.Augment.Tag }}">{{ values.Augment.Name }}</a>
              {% else %}
                {{ values.Augment.Name }}
              {% endif %}
            {% else %}
              <span style="color: #888;">-</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    </div>
    {% endif %}

    {% if final_resistances %}
    <div class="section final-resistances">
      <h2>Final Resistances</h2>
      <table class="resistances-table">
        <thead>
          <tr>
            <th>Type</th>
            <th>Final</th>
            <th>Target</th>
            <th>Deficit</th>
          </tr>
        </thead>
        <tbody>
          {% for res, val in final_resistances.items() %}
          <tr>
            <td>{{ res }}</td>
            <td>
              <span class="res-val
                {% if val >= 80 %}success
                {% elif val >= 60 %}warning
                {% else %}danger
                {% endif %}">
                {{ val }}%
              </span>
            </td>
            <td>
              {% set target_resistance = target_resistances.get(res) %}
                <span class="res-val
                  {% if target_resistance >= 80 %}success
                  {% elif target_resistance >= 60 %}warning
                  {% else %}danger
                  {% endif %}">
                  {{ target_resistance }}%
                </span>
            </td>
            <td>
              {% set gap_resistance = gap_resistances.get(res) %}
                <span class="res-val
                  {% if gap_resistance == 0 %}success
                  {% elif 0 < gap_resistance <= 20 %}warning
                  {% elif gap_resistance >= 20 %}danger
                  {% else %} 
                  {% endif %}">
                  {{ gap_resistance }}%
                </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}

  </div>

  <script src="/static/index.js"></script>

  <!-- Include the localization system -->
  {% include 'button_language.html' %}
</body>
</html>
